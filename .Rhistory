# Worling directory
setwd("C:/Users/vquadros/Dropbox/tradeDeforestation/theory/simulation_exercises")
file <- read_sf("02_inputs/dashboard_states-static-layer.shp")
# Loading libraries
library(sf)
library(dplyr)
library(ggplot2)
library(raster)
library(tiff)
library(terra)
# Worling directory
setwd("C:/Users/vquadros/Dropbox/tradeDeforestation/theory/simulation_exercises")
file <- read_sf("02_inputs/dashboard_states-static-layer.shp")
# Check CRS
if (is.na(st_crs(file)$epsg) || st_crs(file)$epsg != 4326) {
file <- st_transform(file, 4326)
}
# Filtering Mato Grosso's geometry
MT <- file %>% filter(name == "MATO GROSSO")
grid <- rast(ext(-61.2, -50.2, -18, -7.3), resolution = 0.01, crs = "epsg:4326") %>%
setValues(1)
# crop the 0.01deg cell to obtain those only in Brazil
template <- mask(grid, vect(MT))
deforestation <- read_sf("02_inputs/sf_file_2002.gpkg") %>% filter(land_use %in% c("pasture","agri"))
deforestation <- st_intersection(deforestation, MT)
deforestation_raster <- rasterize(deforestation, template, field = 1, fun = "sum", cover = TRUE, background = 0)
writeRaster(prot_major, "03_outputs/deforestation001.tif", overwrite=TRUE)
writeRaster(deforestation_raster, "03_outputs/deforestation001.tif", overwrite=TRUE)
# Load
productivity <- raster("02_inputs/High_soyb200b_yld.tif")
# Crop
productivity <- crop(raster_data, st_bbox(MT))
productivity <- raster("02_inputs/High_soyb200b_yld.tif")
# Crop
productivity <- crop(productivity, st_bbox(MT))
# Mask
productivity <- mask(productivity)
# Mask
productivity <- mask(productivity, MT)
# Resample
productivity_raster <- resample(productivity, deforestation_raster, method = "near")
# Resample
productivity_raster <- resample(productivity, rast(deforestation_raster), method = "near")
# Load
productivity <- rast("02_inputs/High_soyb200b_yld.tif")
# Crop
productivity <- crop(productivity, st_bbox(MT))
# Mask
productivity <- mask(productivity, MT)
# Resample
productivity_raster <- resample(productivity, deforestation_raster, method = "near")
ncells(productivity_raster)
size(productivity_raster)
size(deforestation_raster)
# Loading protected areas and conservation units
conservation_units <- st_intersection(st_read("02_inputs/conservation_units_legal_amazon.shp"),
MT)
indiginous_sites <- st_intersection(st_read("02_inputs/indigenous_area_legal_amazon.shp"),
MT)
# Loading indiginous sites and conservation units and intersecting with MT
conservation_units <- st_intersection(st_read("02_inputs/conservation_units_legal_amazon.shp", crs = "epsg:4326"),
MT)
# Loading indiginous sites and conservation units and intersecting with MT
conservation_units <- st_read("02_inputs/conservation_units_legal_amazon.shp")
indiginous_sites <- st_read("02_inputs/indigenous_area_legal_amazon.shp")
if (is.na(st_crs(conservation_units)$epsg) || st_crs(conservation_units)$epsg != 4326) {
file <- st_transform(conservation_units, 4326)
}
if (is.na(st_crs(indiginous_sites)$epsg) || st_crs(indiginous_sites)$epsg != 4326) {
file <- st_transform(indiginous_sites, 4326)
}
protected <- st_union(conservation_units,indiginous_sites)
plot(indiginous_sites)
st_crs(indiginous_sites)
st_crs(indiginous_sites)== st_crs(conservation_units)
conservation_units <- st_buffer(conservation_units,0)
conservation_units <- st_make_valid(conservation_units)
protected <- st_union(conservation_units,indiginous_sites)
conservation_units <- st_intersection(conservation_units,MT)
# CRS sanity check
if (is.na(st_crs(conservation_units)$epsg) || st_crs(conservation_units)$epsg != 4326) {
file <- st_transform(conservation_units, st_crs(MT))
}
if (is.na(st_crs(indiginous_sites)$epsg) || st_crs(indiginous_sites)$epsg != 4326) {
file <- st_transform(indiginous_sites, st_crs(MT))
}
conservation_units <- st_intersection(conservation_units,MT)
# CRS sanity check
if (is.na(st_crs(conservation_units)$epsg) || st_crs(conservation_units)$epsg != 4326) {
conservation_units <- st_transform(conservation_units, st_crs(MT))
}
if (is.na(st_crs(indiginous_sites)$epsg) || st_crs(indiginous_sites)$epsg != 4326) {
indiginous_sites <- st_transform(indiginous_sites, st_crs(MT))
}
conservation_units <- st_intersection(conservation_units,MT)
plot(conservation_units)
indiginous_sites <- st-intersection(indiginous_sites,MT)
indiginous_sites <- st_intersection(indiginous_sites,MT)
protected <- st_union(conservation_units,indiginous_sites)
save(protected,"03_outputs/protected_areas.RData")
save("03_outputs/protected_areas.RData", protected)
save(protected, file = "03_outputs/protected_areas.RData")
protected_raster <- rasterize(protected, template, field = 1, fun = "sum", cover = TRUE, background = 0)
s
writeRaster(productivity_raster, "03_outputs/productivity001.tif", overwrite=TRUE)
writeRaster(protected_raster, "03_outputs/protected001.tif", overwrite=TRUE)
writeRaster(deforestation_raster, "03_outputs/exercise_mt/deforestation001.tif", overwrite=TRUE)
writeRaster(productivity_raster, "03_outputs/exercise_mt/productivity001.tif", overwrite=TRUE)
writeRaster(protected_raster, "03_outputs/exercise_mt/protected001.tif", overwrite=TRUE)
